<!doctype html>
<html lang="en">
<head>
Â Â <meta charset="utf-8">
Â Â <title>AMI â€” Dashboard</title>
Â Â <meta name="viewport" content="width=device-width, initial-scale=1">

Â Â <style>
Â Â Â Â body {
Â Â Â Â Â Â margin: 0;
Â Â Â Â Â Â background: #eef3f9;
Â Â Â Â Â Â font-family: Inter, Arial, sans-serif;
Â Â Â Â }

Â Â Â Â /* Top Navigation Bar */
Â Â Â Â .topbar {
Â Â Â Â Â Â background: #0b4f8a;
Â Â Â Â Â Â padding: 14px 22px;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â justify-content: space-between;
Â Â Â Â Â Â color: white;
Â Â Â Â Â Â box-shadow: 0 3px 10px rgba(0,0,0,0.12);
Â Â Â Â }

Â Â Â Â .logo {
Â Â Â Â Â Â height: 42px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â }

Â Â Â Â .logout-btn {
Â Â Â Â Â Â background: #d62828;
Â Â Â Â Â Â border: none;
Â Â Â Â Â Â padding: 10px 18px;
Â Â Â Â Â Â color: white;
Â Â Â Â Â Â border-radius: 8px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â font-size: 15px;
Â Â Â Â Â Â transition: background 0.2s;
Â Â Â Â }
Â Â Â Â .logout-btn:hover {
Â Â Â Â Â Â background: #b81f1f;
Â Â Â Â }

Â Â Â Â /* Main Container */
Â Â Â Â .container {
Â Â Â Â Â Â max-width: 950px;
Â Â Â Â Â Â margin: 40px auto;
Â Â Â Â Â Â background: white;
Â Â Â Â Â Â padding: 28px;
Â Â Â Â Â Â border-radius: 14px;
Â Â Â Â Â Â box-shadow: 0 8px 25px rgba(0,0,0,0.05);
Â Â Â Â }

Â Â Â Â h2 {
Â Â Â Â Â Â margin-top: 0;
Â Â Â Â Â Â color: #0b4f8a;
Â Â Â Â Â Â font-size: 28px;
Â Â Â Â Â Â font-weight: 700;
Â Â Â Â }

Â Â Â Â /* Button Bar */
Â Â Â Â .button-bar {
Â Â Â Â Â Â margin-bottom: 26px;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â justify-content: flex-end;
Â Â Â Â }

Â Â Â Â .btn {
Â Â Â Â Â Â background: #007aff;
Â Â Â Â Â Â padding: 12px 20px;
Â Â Â Â Â Â color: white;
Â Â Â Â Â Â border-radius: 6px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â border: none;
Â Â Â Â Â Â font-size: 16px;
Â Â Â Â Â Â transition: background 0.2s;
Â Â Â Â }
Â Â Â Â .btn:hover {
Â Â Â Â Â Â background: #0066cc;
Â Â Â Â }

Â Â Â Â /* Table Design */
Â Â Â Â table {
Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â border-collapse: collapse;
Â Â Â Â Â Â margin-top: 16px;
Â Â Â Â }

Â Â Â Â th {
Â Â Â Â Â Â background: #eaf2ff;
Â Â Â Â Â Â color: #0b4f8a;
Â Â Â Â Â Â text-align: left;
Â Â Â Â Â Â padding: 14px;
Â Â Â Â Â Â font-size: 15px;
Â Â Â Â Â Â border-bottom: 2px solid #cbd7f1;
Â Â Â Â }

Â Â Â Â td {
Â Â Â Â Â Â padding: 13px;
Â Â Â Â Â Â border-bottom: 1px solid #eee;
Â Â Â Â Â Â font-size: 15px;
Â Â Â Â }

Â Â Â Â tr:hover td {
Â Â Â Â Â Â background: #f6f9ff;
Â Â Â Â }

Â Â Â Â .empty {
Â Â Â Â Â Â text-align: center;
Â Â Â Â Â Â padding: 22px;
Â Â Â Â Â Â color: #666;
Â Â Â Â Â Â font-size: 15px;
Â Â Â Â }

Â Â Â Â /* Mobile Fix */
Â Â Â Â @media (max-width: 600px) {
Â Â Â Â Â Â .container {
Â Â Â Â Â Â Â Â margin: 20px;
Â Â Â Â Â Â Â Â padding: 20px;
Â Â Â Â Â Â }
Â Â Â Â Â Â th, td {
Â Â Â Â Â Â Â Â font-size: 14px;
Â Â Â Â Â Â }
Â Â Â Â }
Â Â </style>
</head>

<body>

Â Â <!-- Top Navigation -->
Â Â <div class="topbar">
Â Â Â Â <img src="/logo.png" class="logo" onclick="window.location.href='dashboard.html'">
Â Â Â Â <button class="logout-btn" id="logoutBtn">Logout</button>
Â Â </div>

Â Â <div class="container">
Â Â Â Â <h2>Your AMI Reports</h2>

Â Â Â Â <div class="button-bar">
Â Â Â Â Â Â <button class="btn" onclick="window.location.href='upload.html'">ðŸ“¤ Upload New Report</button>
Â Â Â Â </div>

Â Â Â Â <table>
Â Â Â Â Â Â <thead>
Â Â Â Â Â Â Â Â <tr>
Â Â Â Â Â Â Â Â Â Â <th>Report Title</th>
Â Â Â Â Â Â Â Â Â Â <th>View</th>
Â Â Â Â Â Â Â Â Â Â <th>Date Uploaded</th>
Â Â Â Â Â Â Â Â </tr>
Â Â Â Â Â Â </thead>
Â Â Â Â Â Â <tbody id="reportsBody">
Â Â Â Â Â Â Â Â <tr><td class="empty" colspan="3">Loading...</td></tr>
Â Â Â Â Â Â </tbody>
Â Â Â Â </table>
Â Â </div>

Â Â <script type="module">
Â Â Â Â const email = localStorage.getItem("user_email");
Â Â Â Â if (!email) {
Â Â Â Â Â Â window.location.href = "login.html";
Â Â Â Â }

Â Â Â Â // Logout button
Â Â Â Â document.getElementById("logoutBtn").onclick = () => {
Â Â Â Â Â Â localStorage.removeItem("user_email");
Â Â Â Â Â Â window.location.href = "login.html";
Â Â Â Â };

Â Â Â Â // Load reports
Â Â Â Â async function loadReports() {
Â Â Â Â Â Â const body = document.getElementById("reportsBody");

Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â const resp = await fetch("/api/get-reports?email=" + encodeURIComponent(email));
Â Â Â Â Â Â Â Â const reports = await resp.json();

Â Â Â Â Â Â Â Â body.innerHTML = "";

Â Â Â Â Â Â Â Â if (!resp.ok || reports.length === 0) {
Â Â Â Â Â Â Â Â Â Â body.innerHTML = `<tr><td class="empty" colspan="3">No reports found.</td></tr>`;
Â Â Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â reports.forEach(r => {
Â Â Â Â Â Â Â Â Â Â body.innerHTML += `
Â Â Â Â Â Â Â Â Â Â Â Â <tr>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>${r.title}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <a href="https://tbyttsfztuudyqbrkonm.supabase.co/storage/v1/object/public/reports/${r.file_path}" 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â target="_blank">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â View File
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </a>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â </td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>${new Date(r.created_at).toLocaleString()}</td>
Â Â Â Â Â Â Â Â Â Â Â Â </tr>
Â Â Â Â Â Â Â Â Â Â `;
Â Â Â Â Â Â Â Â });

Â Â Â Â Â Â } catch (err) {
Â Â Â Â Â Â Â Â console.error(err);
Â Â Â Â Â Â Â Â body.innerHTML = `<tr><td class="empty" colspan="3">Error loading reports.</td></tr>`;
Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â loadReports();
Â Â </script>

</body>
</html>
